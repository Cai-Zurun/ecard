{"remainingRequest":"/Users/zrun/vueSpace/ecard_manager_frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zrun/vueSpace/ecard_manager_frontend/src/components/page/Location.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zrun/vueSpace/ecard_manager_frontend/src/components/page/Location.vue","mtime":1636290100947},{"path":"/Users/zrun/vueSpace/ecard_manager_frontend/node_modules/cache-loader/dist/cjs.js","mtime":1635231739476},{"path":"/Users/zrun/vueSpace/ecard_manager_frontend/node_modules/babel-loader/lib/index.js","mtime":1635231739480},{"path":"/Users/zrun/vueSpace/ecard_manager_frontend/node_modules/cache-loader/dist/cjs.js","mtime":1635231739476},{"path":"/Users/zrun/vueSpace/ecard_manager_frontend/node_modules/vue-loader/lib/index.js","mtime":1635231911752}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGxvYWRBbWFwLCBsb2FkUGx1Z2lucyB9IGZyb20gJ0BhbWFwL2FtYXAtdnVlJzsKCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICdMb2NhdGlvbicsCiAgICBkYXRhKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG1vZGU6ICdzZWFyY2gnLAogICAgICAgICAgICBjZW50ZXI6IG51bGwsCiAgICAgICAgICAgIHpvb206IDEwLAogICAgICAgICAgICBxdWVyeTogJycsCiAgICAgICAgICAgIHNlYXJjaGluZzogZmFsc2UsCiAgICAgICAgICAgIHRpcHM6IFtdLAogICAgICAgICAgICByZXN1bHRzOiBbXSwKICAgICAgICAgICAgcG9zaXRpb246IG51bGwsCiAgICAgICAgICAgIHBhZ2VJbmRleDogMSwKICAgICAgICAgICAgcGFnZVNpemU6IDEwLAogICAgICAgICAgICB0b3RhbDogMCwKICAgICAgICAgICAgc2F0ZWxsaXRlOiBmYWxzZSwKICAgICAgICB9OwogICAgfSwKICAgIGNvbXB1dGVkOiB7CiAgICAgICAgd3JhcHBlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHJlZnMud3JhcHBlcjsKICAgICAgICB9LAogICAgICAgIHBvc2l0aW9uVGV4dCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLnBvc2l0aW9uKSByZXR1cm4gJyc7CiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLnBvc2l0aW9uWzBdfSwgJHt0aGlzLnBvc2l0aW9uWzFdfWA7CiAgICAgICAgfSwKICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIHRoaXMuJHJlYWR5ID0gbmV3IFByb21pc2UoYXN5bmMgcmVzb2x2ZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IEFNYXAgPSBhd2FpdCBsb2FkQW1hcCgpOwogICAgICAgICAgICBhd2FpdCBsb2FkUGx1Z2lucyhbJ0FNYXAuUGxhY2VTZWFyY2gnLCAnQU1hcC5BdXRvQ29tcGxldGUnXSk7CgogICAgICAgICAgICB0aGlzLnBzID0gbmV3IEFNYXAuUGxhY2VTZWFyY2goewogICAgICAgICAgICAgICAgcGFnZVNpemU6IHRoaXMucGFnZVNpemUsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmFjID0gbmV3IEFNYXAuQXV0b0NvbXBsZXRlKCk7CgogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSk7CiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIG9uTWFwQ2xpY2soZSkgewogICAgICAgICAgICBpZiAoZS5sbmdsYXQpIHsKICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSBbZS5sbmdsYXQubG5nLCBlLmxuZ2xhdC5sYXRdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbiA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIHNlYXJjaChjbGVhciA9IGZhbHNlKSB7CiAgICAgICAgICAgIHRoaXMubW9kZSA9ICdyZXN1bHQnOwogICAgICAgICAgICBhd2FpdCB0aGlzLl9yZWFkeTsKCiAgICAgICAgICAgIGlmIChjbGVhcikgewogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRzID0gW107CiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsID0gMDsKICAgICAgICAgICAgICAgIHRoaXMucGFnZUluZGV4ID0gMTsKICAgICAgICAgICAgICAgIHRoaXMucHMuc2V0UGFnZUluZGV4KDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnNlYXJjaGluZyA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IHsgcXVlcnkgfSA9IHRoaXM7CiAgICAgICAgICAgIHRoaXMucHMuc2VhcmNoKHF1ZXJ5LCAoc3RhdHVzLCByZXN1bHQpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAocXVlcnkgIT09IHRoaXMucXVlcnkpIHJldHVybjsKCiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSAnY29tcGxldGUnICYmIHJlc3VsdC5wb2lMaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRzID0gcmVzdWx0LnBvaUxpc3QucG9pczsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFsID0gcmVzdWx0LnBvaUxpc3QuY291bnQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0cyA9IFtdOwogICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWwgPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGF1dG9Db21wbGV0ZShrdykgewogICAgICAgICAgICBpZiAoIWt3KSB7CiAgICAgICAgICAgICAgICB0aGlzLnRpcHMgPSBbXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuYWMuc2VhcmNoKGt3LCAoc3RhdHVzLCByZXN1bHQpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoa3cgIT09IHRoaXMucXVlcnkpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSAnY29tcGxldGUnICYmIHJlc3VsdC50aXBzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGlwcyA9IEFycmF5LmZyb20obmV3IFNldChyZXN1bHQudGlwcy5tYXAodGlwID0+IHRpcC5uYW1lKSkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGlwcyA9IFtdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBmb2N1cyhwb2kpIHsKICAgICAgICAgICAgY29uc3QgcG9zID0gW3BvaS5sb2NhdGlvbi5sbmcsIHBvaS5sb2NhdGlvbi5sYXRdOwogICAgICAgICAgICB0aGlzLnBvc2l0aW9uID0gWy4uLnBvc107CiAgICAgICAgICAgIHRoaXMuY2VudGVyID0gWy4uLnBvc107CiAgICAgICAgfSwKICAgICAgICByZXNldCgpIHsKICAgICAgICAgICAgdGhpcy5wcy5zZXRQYWdlSW5kZXgoMSk7CiAgICAgICAgICAgIHRoaXMucmVzdWx0cyA9IFtdOwogICAgICAgICAgICB0aGlzLnRpcHMgPSBbXTsKICAgICAgICAgICAgdGhpcy50b3RhbCA9IDA7CiAgICAgICAgICAgIHRoaXMubW9kZSA9ICdzZWFyY2gnOwogICAgICAgIH0sCiAgICB9LAogICAgd2F0Y2g6IHsKICAgICAgICBwYWdlSW5kZXgodmFsdWUpIHsKICAgICAgICAgICAgdGhpcy4kcmVhZHkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnBzLnNldFBhZ2VJbmRleCh2YWx1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaChmYWxzZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICB9LAp9Owo="},{"version":3,"sources":["Location.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6GA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Location.vue","sourceRoot":"src/components/page","sourcesContent":["<template>\n    <div class=\"coord-picker\">\n        <div class=\"map-container\">\n            <amap\n                    cache-key=\"coord-picker-map\"\n                    mmap-style=\"amap://styles/whitesmoke\"\n                    async\n                    :center.sync=\"center\"\n                    :zoom.sync=\"zoom\"\n                    is-hotspot\n                    @click=\"onMapClick\"\n            >\n                <amap-satellite-layer :visible=\"satellite\" />\n\n                <amap-marker v-if=\"position\" :position.sync=\"position\" draggable />\n\n                <a-card\n                        :body-style=\"{\n            'max-height': '450px',\n            'overflow-y': 'scroll',\n            'padding-top': 0,\n          }\"\n                        class=\"result-panel\"\n                >\n                    <template slot=\"title\">\n                        <template v-if=\"mode === 'search'\">\n                            <a-input-group compact style=\"display: flex\">\n                                <a-auto-complete\n                                        v-model=\"query\"\n                                        :data-source=\"tips\"\n                                        placeholder=\"输入关键词\"\n                                        style=\"flex: 1\"\n                                        @search=\"autoComplete\"\n                                />\n                                <a-button\n                                        @click=\"search(true)\"\n                                        :disabled=\"!query\"\n                                        type=\"primary\"\n                                >\n                                    搜索\n                                </a-button>\n                            </a-input-group>\n                        </template>\n                        <template v-if=\"mode === 'result'\">\n                            <div class=\"search-bar\">\n                                <a-button\n                                        icon=\"left\"\n                                        @click=\"reset\"\n                                        style=\"margin-right: 6px;\"\n                                />\n                                <span class=\"text\"\n                                >搜索 {{ query }} 共\n                  {{ searching ? '...' : total }} 条结果</span\n                                >\n                            </div>\n                        </template>\n                    </template>\n\n                    <a-list\n                            v-if=\"mode === 'result'\"\n                            :data-source=\"results\"\n                            :loading=\"searching\"\n                            item-layout=\"vertical\"\n                            size=\"small\"\n                            class=\"result-list\"\n                    >\n                        <a-pagination\n                                slot=\"header\"\n                                v-if=\"total > 0\"\n                                v-model=\"pageIndex\"\n                                :page-size=\"pageSize\"\n                                :total=\"total\"\n                                size=\"small\"\n                        />\n                        <a-list-item slot=\"renderItem\" slot-scope=\"item\" :key=\"item.id\">\n                            <a-list-item-meta :description=\"item.address\">\n                <span\n                        slot=\"title\"\n                        style=\"cursor: pointer;\"\n                        @click=\"focus(item)\"\n                >{{ item.name }}</span\n                >\n                            </a-list-item-meta>\n                        </a-list-item>\n                        <a-pagination\n                                slot=\"footer\"\n                                v-if=\"total > 0\"\n                                v-model=\"pageIndex\"\n                                :page-size=\"pageSize\"\n                                :total=\"total\"\n                                size=\"small\"\n                        />\n                    </a-list>\n                </a-card>\n\n                <a-form class=\"info ant-card ant-card-bordered\" layout=\"inline\">\n                    <a-form-item label=\"坐标\" v-if=\"position\">\n                        <a-input read-only :value=\"positionText\" style=\"width: 200px;\" />\n                    </a-form-item>\n                    <a-form-item label=\"卫星图\">\n                        <a-switch v-model=\"satellite\" />\n                    </a-form-item>\n                </a-form>\n            </amap>\n        </div>\n    </div>\n</template>\n\n<script>\n    import { loadAmap, loadPlugins } from '@amap/amap-vue';\n\n    export default {\n        name: 'Location',\n        data() {\n            return {\n                mode: 'search',\n                center: null,\n                zoom: 10,\n                query: '',\n                searching: false,\n                tips: [],\n                results: [],\n                position: null,\n                pageIndex: 1,\n                pageSize: 10,\n                total: 0,\n                satellite: false,\n            };\n        },\n        computed: {\n            wrapper() {\n                return this.$refs.wrapper;\n            },\n            positionText() {\n                if (!this.position) return '';\n                return `${this.position[0]}, ${this.position[1]}`;\n            },\n        },\n        created() {\n            this.$ready = new Promise(async resolve => {\n                const AMap = await loadAmap();\n                await loadPlugins(['AMap.PlaceSearch', 'AMap.AutoComplete']);\n\n                this.ps = new AMap.PlaceSearch({\n                    pageSize: this.pageSize,\n                });\n                this.ac = new AMap.AutoComplete();\n\n                resolve();\n            });\n        },\n        methods: {\n            onMapClick(e) {\n                if (e.lnglat) {\n                    this.position = [e.lnglat.lng, e.lnglat.lat];\n                } else {\n                    this.position = null;\n                }\n            },\n            async search(clear = false) {\n                this.mode = 'result';\n                await this._ready;\n\n                if (clear) {\n                    this.results = [];\n                    this.total = 0;\n                    this.pageIndex = 1;\n                    this.ps.setPageIndex(1);\n                }\n\n                this.searching = true;\n                const { query } = this;\n                this.ps.search(query, (status, result) => {\n                    this.searching = false;\n                    if (query !== this.query) return;\n\n                    if (status === 'complete' && result.poiList) {\n                        this.results = result.poiList.pois;\n                        this.total = result.poiList.count;\n                    } else {\n                        this.results = [];\n                        this.total = 0;\n                    }\n                });\n            },\n            async autoComplete(kw) {\n                if (!kw) {\n                    this.tips = [];\n                } else {\n                    this.ac.search(kw, (status, result) => {\n                        if (kw !== this.query) return;\n                        if (status === 'complete' && result.tips) {\n                            this.tips = Array.from(new Set(result.tips.map(tip => tip.name)));\n                        } else {\n                            this.tips = [];\n                        }\n                    });\n                }\n            },\n            focus(poi) {\n                const pos = [poi.location.lng, poi.location.lat];\n                this.position = [...pos];\n                this.center = [...pos];\n            },\n            reset() {\n                this.ps.setPageIndex(1);\n                this.results = [];\n                this.tips = [];\n                this.total = 0;\n                this.mode = 'search';\n            },\n        },\n        watch: {\n            pageIndex(value) {\n                this.$ready.then(() => {\n                    this.ps.setPageIndex(value);\n                    this.search(false);\n                });\n            },\n        },\n    };\n</script>\n\n<style lang=\"less\" scoped>\n    .map-container {\n        width: 100%;\n        height: 600px;\n    }\n\n    .result-panel {\n        position: absolute;\n        left: 10px;\n        top: 10px;\n        width: 320px;\n        display: flex;\n        flex-direction: column;\n\n        .search-bar {\n            display: flex;\n            align-items: center;\n            .text {\n                text-overflow: ellipsis;\n                flex: 1;\n                overflow: hidden;\n                white-space: nowrap;\n            }\n        }\n\n        .result-list.ant-list-loading {\n            min-height: 100px;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n    }\n    .info {\n        position: absolute;\n        right: 10px;\n        top: 10px;\n        padding-left: 24px;\n    }\n</style>"]}]}