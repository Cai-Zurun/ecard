{"remainingRequest":"/Users/zrun/vueSpace/ecard_manager_frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zrun/vueSpace/ecard_manager_frontend/src/components/page/Location.vue?vue&type=style&index=0&id=e776f616&lang=less&scoped=true&","dependencies":[{"path":"/Users/zrun/vueSpace/ecard_manager_frontend/src/components/page/Location.vue","mtime":1636290100947},{"path":"/Users/zrun/vueSpace/ecard_manager_frontend/node_modules/css-loader/dist/cjs.js","mtime":1635231904892},{"path":"/Users/zrun/vueSpace/ecard_manager_frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1635231911752},{"path":"/Users/zrun/vueSpace/ecard_manager_frontend/node_modules/postcss-loader/src/index.js","mtime":1635231910975},{"path":"/Users/zrun/vueSpace/ecard_manager_frontend/node_modules/less-loader/dist/cjs.js","mtime":1635811351528},{"path":"/Users/zrun/vueSpace/ecard_manager_frontend/node_modules/cache-loader/dist/cjs.js","mtime":1635231739476},{"path":"/Users/zrun/vueSpace/ecard_manager_frontend/node_modules/vue-loader/lib/index.js","mtime":1635231911752}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoubWFwLWNvbnRhaW5lciB7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogNjAwcHg7Cn0KCi5yZXN1bHQtcGFuZWwgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgbGVmdDogMTBweDsKICAgIHRvcDogMTBweDsKICAgIHdpZHRoOiAzMjBweDsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwoKICAgIC5zZWFyY2gtYmFyIHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgLnRleHQgewogICAgICAgICAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKICAgICAgICAgICAgZmxleDogMTsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICAgICAgICB9CiAgICB9CgogICAgLnJlc3VsdC1saXN0LmFudC1saXN0LWxvYWRpbmcgewogICAgICAgIG1pbi1oZWlnaHQ6IDEwMHB4OwogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIH0KfQouaW5mbyB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICByaWdodDogMTBweDsKICAgIHRvcDogMTBweDsKICAgIHBhZGRpbmctbGVmdDogMjRweDsKfQo="},{"version":3,"sources":["Location.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgOA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Location.vue","sourceRoot":"src/components/page","sourcesContent":["<template>\n    <div class=\"coord-picker\">\n        <div class=\"map-container\">\n            <amap\n                    cache-key=\"coord-picker-map\"\n                    mmap-style=\"amap://styles/whitesmoke\"\n                    async\n                    :center.sync=\"center\"\n                    :zoom.sync=\"zoom\"\n                    is-hotspot\n                    @click=\"onMapClick\"\n            >\n                <amap-satellite-layer :visible=\"satellite\" />\n\n                <amap-marker v-if=\"position\" :position.sync=\"position\" draggable />\n\n                <a-card\n                        :body-style=\"{\n            'max-height': '450px',\n            'overflow-y': 'scroll',\n            'padding-top': 0,\n          }\"\n                        class=\"result-panel\"\n                >\n                    <template slot=\"title\">\n                        <template v-if=\"mode === 'search'\">\n                            <a-input-group compact style=\"display: flex\">\n                                <a-auto-complete\n                                        v-model=\"query\"\n                                        :data-source=\"tips\"\n                                        placeholder=\"输入关键词\"\n                                        style=\"flex: 1\"\n                                        @search=\"autoComplete\"\n                                />\n                                <a-button\n                                        @click=\"search(true)\"\n                                        :disabled=\"!query\"\n                                        type=\"primary\"\n                                >\n                                    搜索\n                                </a-button>\n                            </a-input-group>\n                        </template>\n                        <template v-if=\"mode === 'result'\">\n                            <div class=\"search-bar\">\n                                <a-button\n                                        icon=\"left\"\n                                        @click=\"reset\"\n                                        style=\"margin-right: 6px;\"\n                                />\n                                <span class=\"text\"\n                                >搜索 {{ query }} 共\n                  {{ searching ? '...' : total }} 条结果</span\n                                >\n                            </div>\n                        </template>\n                    </template>\n\n                    <a-list\n                            v-if=\"mode === 'result'\"\n                            :data-source=\"results\"\n                            :loading=\"searching\"\n                            item-layout=\"vertical\"\n                            size=\"small\"\n                            class=\"result-list\"\n                    >\n                        <a-pagination\n                                slot=\"header\"\n                                v-if=\"total > 0\"\n                                v-model=\"pageIndex\"\n                                :page-size=\"pageSize\"\n                                :total=\"total\"\n                                size=\"small\"\n                        />\n                        <a-list-item slot=\"renderItem\" slot-scope=\"item\" :key=\"item.id\">\n                            <a-list-item-meta :description=\"item.address\">\n                <span\n                        slot=\"title\"\n                        style=\"cursor: pointer;\"\n                        @click=\"focus(item)\"\n                >{{ item.name }}</span\n                >\n                            </a-list-item-meta>\n                        </a-list-item>\n                        <a-pagination\n                                slot=\"footer\"\n                                v-if=\"total > 0\"\n                                v-model=\"pageIndex\"\n                                :page-size=\"pageSize\"\n                                :total=\"total\"\n                                size=\"small\"\n                        />\n                    </a-list>\n                </a-card>\n\n                <a-form class=\"info ant-card ant-card-bordered\" layout=\"inline\">\n                    <a-form-item label=\"坐标\" v-if=\"position\">\n                        <a-input read-only :value=\"positionText\" style=\"width: 200px;\" />\n                    </a-form-item>\n                    <a-form-item label=\"卫星图\">\n                        <a-switch v-model=\"satellite\" />\n                    </a-form-item>\n                </a-form>\n            </amap>\n        </div>\n    </div>\n</template>\n\n<script>\n    import { loadAmap, loadPlugins } from '@amap/amap-vue';\n\n    export default {\n        name: 'Location',\n        data() {\n            return {\n                mode: 'search',\n                center: null,\n                zoom: 10,\n                query: '',\n                searching: false,\n                tips: [],\n                results: [],\n                position: null,\n                pageIndex: 1,\n                pageSize: 10,\n                total: 0,\n                satellite: false,\n            };\n        },\n        computed: {\n            wrapper() {\n                return this.$refs.wrapper;\n            },\n            positionText() {\n                if (!this.position) return '';\n                return `${this.position[0]}, ${this.position[1]}`;\n            },\n        },\n        created() {\n            this.$ready = new Promise(async resolve => {\n                const AMap = await loadAmap();\n                await loadPlugins(['AMap.PlaceSearch', 'AMap.AutoComplete']);\n\n                this.ps = new AMap.PlaceSearch({\n                    pageSize: this.pageSize,\n                });\n                this.ac = new AMap.AutoComplete();\n\n                resolve();\n            });\n        },\n        methods: {\n            onMapClick(e) {\n                if (e.lnglat) {\n                    this.position = [e.lnglat.lng, e.lnglat.lat];\n                } else {\n                    this.position = null;\n                }\n            },\n            async search(clear = false) {\n                this.mode = 'result';\n                await this._ready;\n\n                if (clear) {\n                    this.results = [];\n                    this.total = 0;\n                    this.pageIndex = 1;\n                    this.ps.setPageIndex(1);\n                }\n\n                this.searching = true;\n                const { query } = this;\n                this.ps.search(query, (status, result) => {\n                    this.searching = false;\n                    if (query !== this.query) return;\n\n                    if (status === 'complete' && result.poiList) {\n                        this.results = result.poiList.pois;\n                        this.total = result.poiList.count;\n                    } else {\n                        this.results = [];\n                        this.total = 0;\n                    }\n                });\n            },\n            async autoComplete(kw) {\n                if (!kw) {\n                    this.tips = [];\n                } else {\n                    this.ac.search(kw, (status, result) => {\n                        if (kw !== this.query) return;\n                        if (status === 'complete' && result.tips) {\n                            this.tips = Array.from(new Set(result.tips.map(tip => tip.name)));\n                        } else {\n                            this.tips = [];\n                        }\n                    });\n                }\n            },\n            focus(poi) {\n                const pos = [poi.location.lng, poi.location.lat];\n                this.position = [...pos];\n                this.center = [...pos];\n            },\n            reset() {\n                this.ps.setPageIndex(1);\n                this.results = [];\n                this.tips = [];\n                this.total = 0;\n                this.mode = 'search';\n            },\n        },\n        watch: {\n            pageIndex(value) {\n                this.$ready.then(() => {\n                    this.ps.setPageIndex(value);\n                    this.search(false);\n                });\n            },\n        },\n    };\n</script>\n\n<style lang=\"less\" scoped>\n    .map-container {\n        width: 100%;\n        height: 600px;\n    }\n\n    .result-panel {\n        position: absolute;\n        left: 10px;\n        top: 10px;\n        width: 320px;\n        display: flex;\n        flex-direction: column;\n\n        .search-bar {\n            display: flex;\n            align-items: center;\n            .text {\n                text-overflow: ellipsis;\n                flex: 1;\n                overflow: hidden;\n                white-space: nowrap;\n            }\n        }\n\n        .result-list.ant-list-loading {\n            min-height: 100px;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n    }\n    .info {\n        position: absolute;\n        right: 10px;\n        top: 10px;\n        padding-left: 24px;\n    }\n</style>"]}]}